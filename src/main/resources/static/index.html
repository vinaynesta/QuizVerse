<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Java Quiz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .quiz-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .question {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .history {
            margin-left: 600px;
            background-color: #2196f3;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .options {
            display: grid;
            gap: 10px;
            margin-top: 10px;
        }
        .option {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .option:hover {
            background-color: #f0f0f0;
        }
        .option.selected {
            background-color: #e3f2fd;
            border-color: #2196f3;
        }
        .option.correct {
            background-color: #c8e6c9;
            border-color: #4caf50;
        }
        .option.incorrect {
            background-color: #ffcdd2;
            border-color: #f44336;
        }
        .button {
            background-color: #2196f3;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
        }
        .correct-answer {
            color: #4caf50;
        }
        .incorrect-answer {
            color: #f44336;
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <h1>Java Quiz</h1>
        <div id="start-screen">
            <button id="start-button" class="button">Start Quiz</button>
        </div>
        <div id="quiz-screen" style="display: none;">
            <div id="question-container"></div>
            <div id="result-container" class="result" style="display: none;"></div>
            <button id="next-button" class="button" style="display: none;">Next Question</button>
            <button id="finish-button" class="button" style="display: none;">Finish Quiz</button>
            <button id="new-quiz-button" class="button" style="display: none;">Start New Quiz</button>
            <button id="history-button" class="history" style="display: none;">History</button>
        </div>
    </div>

    <script>
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;

        document.getElementById('start-button').addEventListener('click', startQuiz);
        document.getElementById('next-button').addEventListener('click', showNextQuestion);
        document.getElementById('finish-button').addEventListener('click', showFinalResult);
        document.getElementById('new-quiz-button').addEventListener('click', startQuiz);
        document.getElementById('history-button').addEventListener('click', showHistory);

        async function startQuiz() {
            try {
                const response = await fetch('/api/quiz/questions');
                currentQuestions = await response.json();
                console.log("current questions : "+currentQuestions);
                currentQuestionIndex = 0;
                score = 0;
                
                document.getElementById('start-screen').style.display = 'none';
                document.getElementById('quiz-screen').style.display = 'block';
                document.getElementById('new-quiz-button').style.display = 'none';
                document.getElementById('history-button').style.display = 'none';
                showQuestion();
            } catch (error) {
                console.error('Error fetching questions:', error);
            }
        }

        function showQuestion() {
            const question = currentQuestions[currentQuestionIndex];
            const container = document.getElementById('question-container');
            
            container.innerHTML = `
                <div class="question">
                    <h3>Question ${currentQuestionIndex + 1} of 5</h3>
                    <p>${question.questionText}</p>
                    <div class="options">
                        <div class="option" onclick="selectOption(this, '${question.optionA}')">${question.optionA}</div>
                        <div class="option" onclick="selectOption(this, '${question.optionB}')">${question.optionB}</div>
                        <div class="option" onclick="selectOption(this, '${question.optionC}')">${question.optionC}</div>
                        <div class="option" onclick="selectOption(this, '${question.optionD}')">${question.optionD}</div>
                    </div>
                </div>
            `;

            document.getElementById('result-container').style.display = 'none';
            document.getElementById('next-button').style.display = 'none';
            document.getElementById('finish-button').style.display = 'none';
        }

        async function selectOption(element, selectedAnswer) {
            if (element.classList.contains('selected')) return;
            
            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');

            const question = currentQuestions[currentQuestionIndex];
            try {
                const response = await fetch('/api/quiz/verify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        questionId: question.id,
                        selectedAnswer: selectedAnswer
                    })
                });

                fetch('/api/quiz/addHistory', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        questionId: question.id,
                        selectedAnswer: selectedAnswer
                    })
                });

                const result = await response.json();
                if (result.correct) {
                    score++;
                    element.classList.add('correct');
                    showResult('Correct!', true);
                } else {
                    element.classList.add('incorrect');
                    const correctOption = Array.from(options).find(opt => 
                        opt.textContent === result.correctAnswer
                    );
                    if (correctOption) correctOption.classList.add('correct');
                    showResult(`Incorrect. The correct answer is: ${result.correctAnswer}`, false);
                }

                if (currentQuestionIndex < 4) {
                    document.getElementById('next-button').style.display = 'block';
                } else {
                    document.getElementById('finish-button').style.display = 'block';
                }
            } catch (error) {
                console.error('Error verifying answer:', error);
            }
        }

        function showResult(message, isCorrect) {
            const resultContainer = document.getElementById('result-container');
            resultContainer.textContent = message;
            resultContainer.className = 'result ' + (isCorrect ? 'correct-answer' : 'incorrect-answer');
            resultContainer.style.display = 'block';
        }

        function showNextQuestion() {
            currentQuestionIndex++;
            showQuestion();
            document.getElementById('history-button').style.display = 'block';
        }

        function showFinalResult() {
            const container = document.getElementById('question-container');
            container.innerHTML = `
                <div class="question">
                    <h2>Quiz Complete!</h2>
                    <p>Your score: ${score} out of 5</p>
                    <p>Percentage: ${(score/5*100).toFixed(2)}%</p>
                </div>
            `;
            
            document.getElementById('result-container').style.display = 'none';
            document.getElementById('finish-button').style.display = 'none';
            document.getElementById('new-quiz-button').style.display = 'block';
            document.getElementById('history-button').style.display = 'block';
        }

        async function showHistory() {
            const container = document.getElementById('question-container');

            const response = await fetch('/api/quiz/history');
            const history = await response.json(); // assuming this is an array or string

            console.log("show history:", history);

            // Format as HTML if it's an array
            const formatted = Array.isArray(history)
                ? history.map((item,index) => `<p>${index+1}. ${item.questionText} <br> &rarr; ${item.correctAnswer}</p>`).join("")
                : `<p>${history}</p>`;

            container.innerHTML = `
                <div class="question">
                    <h3>History</h3>
                    ${formatted}
                </div>
            `;
        }
    </script>
</body>
</html> 